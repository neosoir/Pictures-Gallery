!function($){"use strict";$(".bcpg-container").bcpg();var $precargador=$(".precargador"),urledit="?page=bcpg&action=edit&id=",idTable=$("#idTable").val(),marco;$(".modal").modal(),$("select").material_select(),$(".addbcpg").on("click",(function(e){e.preventDefault(),$("#addbcpg").modal("open")}));var $type=$("#type"),type_val=null,$select=$(".select-dropdown"),$selectionCustom=$("#custom"),$selectionCategory=$("#category"),$setCategory=$("#setCategory"),$addItems,marco,$changeImgItem,mediaSingle;"custom"==$type.val()?($selectionCustom.css("display","block"),$selectionCategory.css("display","none"),$setCategory.css("display","none")):"category"==$type.val()&&($selectionCustom.css("display","none"),$selectionCategory.css("display","block"),$setCategory.css("display","block")),$type.on("change",(function(){type_val=$(this).val(),$select.hasClass("invalid")&&($select.removeClass("invalid"),$select.addClass("valid")),"custom"==type_val?($selectionCustom.css("display","block"),$selectionCategory.css("display","none"),$setCategory.css("display","none")):"category"==type_val&&($selectionCustom.css("display","none"),$selectionCategory.css("display","block"),$setCategory.css("display","block"))})),$("#crear-bcpg").on("click",(function(e){e.preventDefault();var $nombre=$("#nombre-bcpg"),nv=$nombre.val();$precargador.css("display","flex"),""==nv?($precargador.css("display","none"),$nombre.hasClass("invalid")||$nombre.addClass("invalid")):null==type_val||""==type_val?($precargador.css("display","none"),$select.hasClass("invalid")||($select.addClass("invalid"),$select.removeClass("valid"))):$.ajax({url:bcpg.url,type:"POST",dataType:"json",data:{action:"bcpg_crud_gallery",nonce:bcpg.seguridad,nombre:nv,type_val:type_val,tipo:"add"},success:function(data){data.result&&(urledit+=data.insert_id,setTimeout((function(){location.href=urledit}),1300))},error:function(d,x,v){console.log(d),console.log(x),console.log(v)}})})),$(document).on("click","[idbcpgedit]",(function(){var id=$(this).attr("idbcpgedit");location.href=urledit+id})),$(document).on("click","[idbcpgremove]",(function(){var id=$(this).attr("idbcpgremove"),$tr=$('tr[data-bcpg="'+id+'"]'),nombre=$tr.find($("td:nth-child(1)")).text();swal({title:"¿Estás seguro que quieres eliminar la galería '"+nombre+"'?",text:"No podrás deshacer esto!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Si, borrarlo",closeOnConfirm:!1,showLoaderOnConfirm:!0,html:!0},(function(isConfirm){isConfirm&&$.ajax({url:bcpg.url,type:"POST",dataType:"json",data:{action:"bcpg_crud_gallery",nonce:bcpg.seguridad,tipo:"delete",idgal:id},success:function(data){data.result?setTimeout((function(){swal({title:"Borrado",text:"La galería "+nombre+" ha sido eliminado",type:"success",timer:1500}),$tr.css({background:"red",color:"white"}).fadeOut(600),setTimeout((function(){$tr.remove()}),1e3)}),1500):swal({title:"Error",text:"Hubo un error al eliminar la galería, por favor intenta más tarde",type:"error",timer:2e3})},error:function(d,x,v){console.log(d),console.log(x),console.log(v)}})}))})),$("#addItems").on("click",(function(){marco?marco.open():((marco=wp.media({title:"Seleccionar esta imagen",button:{text:"Usar esta imagen"},multiple:!0,library:{type:"image"}})).on("select",(function(){var adjuntos=marco.state().get("selection").map((function(adj){return adj.toJSON()})),output=Beziercode.templateItems(adjuntos);$(".bcpg-container").append(output)})),marco.open())})),$("#columnas").on("change",(function(params){var $this=$(this),valor=parseInt($this.val()),$items=$(".bcpg-item"),$itemsCat=$(".bcpg-carditem");if($items.length){var arrClass=$items.attr("class").split(" "),er=/m[346]/,r=null,col=null;for(var i in arrClass)"function"!=typeof arrClass[i]&&null!=(r=arrClass[i].match(er))&&(col=r.input);if(null!==col&&$items&&$items.hasClass(col))switch($items.removeClass(col),valor){case 2:$items.addClass("m6");break;case 3:$items.addClass("m4");break;case 4:$items.addClass("m3")}}if($itemsCat.length){var arrClass=$itemsCat.attr("class").split(" "),er=/m[346]/,r=null,col=null;for(var i in arrClass)"function"!=typeof arrClass[i]&&null!=(r=arrClass[i].match(er))&&(col=r.input);if(null!==col&&$itemsCat&&$itemsCat.hasClass(col))switch($itemsCat.removeClass(col),valor){case 2:$itemsCat.addClass("m6");break;case 3:$itemsCat.addClass("m4");break;case 4:$itemsCat.addClass("m3")}}})),$(document).on("click",".edit-item",(function(){$("#bpcg-item-edit").modal("open");var $li=$(this).parents("li"),id=$li.attr("data-id"),title=$li.attr("data-title"),src=$li.attr("data-src"),dataValue,filters=$li.attr("data-value").split(";"),er=/filters/,r=null,arf=null;for(const i in filters)"function"!=typeof filters[i]&&null!==(r=filters[i].match(er))&&(arf=r.input.split("="));null!==arf?$("#edit-item-filters").val(arf[1]):$("#edit-item-filters").val(""),$("#edit-item-id").val(id),$("#edit-item-title").val(title),$("#edit-item-img").attr({src:src,"data-id":id})})),$("#change-img-item").on("click",(function(){mediaSingle?mediaSingle.open():((mediaSingle=wp.media({title:"Selecciona la imagen a cambiar",button:{text:"Usar esta imagen"},multiple:!1})).on("select",(function(){var adjunto=mediaSingle.state().get("selection").first().toJSON(),url=adjunto.url;$("#edit-item-img").attr({src:url,"data-id":adjunto.id})})),mediaSingle.open())})),$("#update-item").on("click",(function(){var id=$("#edit-item-id").val(),title=$("#edit-item-title").val(),src=$("#edit-item-img").attr("src"),filters=$("#edit-item-filters").val(),$item=$('[data-id="'+id+'"]');$item.find("img").attr("src",src);var idN=$("#edit-item-img").attr("data-id"),valsUpdated=["media="+src,"title="+title,"filters="+filters,"id="+idN];$item.attr({"data-value":valsUpdated.join(";"),"data-title":title,"data-src":src,"data-f":Beziercode.normalize(filters),"data-id":idN});var $titleItem=$item.find(".title-item h5");if($titleItem.length)""!==title?$titleItem.text(title):$(".title-item").remove();else if(""!==title){var output=Beziercode.addTitleItem(title);$item.find(".bcpg-masc").before(output)}if($(".bcpg-container li").length){$("ul.bcpg-ul").find("li").remove();var filtersArr=Beziercode.analizadorFiltros(".bcpg-container li");$("ul.bcpg-ul").append(Beziercode.templateBtnFilter(filtersArr))}})),$(".bcpg-container").sortable(),$("#guardar-items").on("click",(function(){var dataValueItems=$(".bcpg-container").sortable("toArray",{attribute:"data-value"}),objetoItem=Beziercode.toObject(dataValueItems),idgalbcpg=$("#idgalbcpg").val(),nombregalbcpg=$("#nombregalbcpg").val(),type=$("#type").val(),columnas,bcpgMaster={bcpg:{name:nombregalbcpg}},conf={settings:{columns:$("#columnas").val()}},data=$.extend({},bcpgMaster,objetoItem,conf);$.ajax({url:bcpg.url,type:"POST",dataType:"json",data:{action:"bcpg_data",nonce:bcpg.seguridad,idgalbcpg:idgalbcpg,nombregalbcpg:nombregalbcpg,type:type,data:JSON.stringify(data)},success:function(data){data.result&&swal({title:"Guardar!",text:"La informacion se ha guardado con exito",type:"success",tiner:15e3})},error:function(d,x,v){console.log(d),console.log(x),console.log(v)}})}))}(jQuery);